<div class='chat'>
  <div class='sidebar'>
    <div class='user-list'>
      <ul class='ul-list' style='list-style: none;'>
        <% @users.each do |u| %>
            <li class='li-list' data-uid="<%= u.id %>">
              <p class='name'><%=u.name%></p>
            </li>
        <%end%>
      </ul>
    </div>
  </div>
  <div class='main-messages'>
    <div class='messages'>
      <label id='business_id' hidden><%= params[:business_id] %></label>
      <label id='user_id' hidden></label>
      <ul class='message'></ul>
    </div>
    <div class='inputs'>
      <form>
        <textarea disabled data-behavior='room_speaker' placeholder="按 Enter 发送"></textarea>
      </form>
      
    </div>
  </div>
</div>

<script>
    $(function () {  
        $('ul.ul-list li').each(function () {  
            $(this).click(function(){
              $(".li-list.active").removeClass('active')
              $(this).addClass('active');
              $('textarea').removeAttr('disabled');
              $('#user_id').text($(this).data('uid'));
              $.get(
                  "<%= messages_customer_service_business_chats_path(params[:business_id])  %>",
                  {user_id: $(this).data('uid')},
                  function(data){
                    $('ul.message').empty();
                    var business_id = "<%= params[:business_id] %>";
                      $.each(data, function(index,item){
                        var string = "";
                        if(business_id === item.from_id){
                          string = "right";
                        }else{
                          string = "left";
                        }
                          $('ul.message').append("<li class='"+ string +"'><div class='message-content'>"+ item.content +"</div></li>")
                      })
                      $(".messages").scrollTop($(".messages")[0].scrollHeight);
                  }
              );
        });  
    });
    });
</script>
